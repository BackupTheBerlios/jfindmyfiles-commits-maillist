<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Jfindmyfiles-commits] r144 - in trunk: docs docs/Iteracao4-CB04	docs/Iteracao6-CB07 docs/Iteracao7-CB06 docs/Iteracao8-CB08	project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog	project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities	project/JFindMyFiles/ExportEngine/src/de/berlios/jfindmyfiles/exportengine	project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs	project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/nodes	project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles	spikes/Prototipos/src/de/berlios/kcookb/imagens
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/jfindmyfiles-commits/2008-June/index.html" >
   <LINK REL="made" HREF="mailto:jfindmyfiles-commits%40lists.berlios.de?Subject=Re%3A%20%5BJfindmyfiles-commits%5D%20r144%20-%20in%20trunk%3A%20docs%20docs/Iteracao4-CB04%0A%09docs/Iteracao6-CB07%20docs/Iteracao7-CB06%20docs/Iteracao8-CB08%0A%09project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog%0A%09project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities%0A%09project/JFindMyFiles/ExportEngine/src/de/berlios/jfindmyfiles/exportengine%0A%09project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs%0A%09project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/nodes%0A%09project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles%0A%09spikes/Prototipos/src/de/berlios/kcookb/imagens&In-Reply-To=%3C200806120117.m5C1HXNM031206%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000138.html">
   <LINK REL="Next"  HREF="000140.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Jfindmyfiles-commits] r144 - in trunk: docs docs/Iteracao4-CB04	docs/Iteracao6-CB07 docs/Iteracao7-CB06 docs/Iteracao8-CB08	project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog	project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities	project/JFindMyFiles/ExportEngine/src/de/berlios/jfindmyfiles/exportengine	project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs	project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/nodes	project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles	spikes/Prototipos/src/de/berlios/kcookb/imagens</H1>
    <B>knitter at mail.berlios.de</B> 
    <A HREF="mailto:jfindmyfiles-commits%40lists.berlios.de?Subject=Re%3A%20%5BJfindmyfiles-commits%5D%20r144%20-%20in%20trunk%3A%20docs%20docs/Iteracao4-CB04%0A%09docs/Iteracao6-CB07%20docs/Iteracao7-CB06%20docs/Iteracao8-CB08%0A%09project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog%0A%09project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities%0A%09project/JFindMyFiles/ExportEngine/src/de/berlios/jfindmyfiles/exportengine%0A%09project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs%0A%09project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/nodes%0A%09project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles%0A%09spikes/Prototipos/src/de/berlios/kcookb/imagens&In-Reply-To=%3C200806120117.m5C1HXNM031206%40sheep.berlios.de%3E"
       TITLE="[Jfindmyfiles-commits] r144 - in trunk: docs docs/Iteracao4-CB04	docs/Iteracao6-CB07 docs/Iteracao7-CB06 docs/Iteracao8-CB08	project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog	project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities	project/JFindMyFiles/ExportEngine/src/de/berlios/jfindmyfiles/exportengine	project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs	project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/nodes	project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles	spikes/Prototipos/src/de/berlios/kcookb/imagens">knitter at mail.berlios.de
       </A><BR>
    <I>Thu Jun 12 03:17:33 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000138.html">[Jfindmyfiles-commits] r143 - in trunk/project/JFindMyFiles:	Catalog/src/de/berlios/jfindmyfiles/catalog	ExportEngine/src/de/berlios/jfindmyfiles/exportengine	JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs	JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/utils	ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles	ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles/utils
</A></li>
        <LI>Next message: <A HREF="000140.html">[Jfindmyfiles-commits] r145 - in trunk: docs/Iteracao3-CB03	project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities	project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui	project/JFindMyFiles/ReadingFiles/nbproject	project/JFindMyFiles/ReadingFiles/src/META-INF/services	project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles	project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles/pluginapi	project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles/plugins	project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles/utils	spikes/PluginAPI spikes/PluginAPI/nbproject spikes/PluginAPI/src	spikes/PluginAPI/src/de/berlios/jfindmyfiles	spikes/PluginAPI/src/de/berlios/jfindmyfiles/catalog/entities	spikes/PluginAPI/src/pluginapi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#139">[ date ]</a>
              <a href="thread.html#139">[ thread ]</a>
              <a href="subject.html#139">[ subject ]</a>
              <a href="author.html#139">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: knitter
Date: 2008-06-12 03:17:02 +0200 (Thu, 12 Jun 2008)
New Revision: 144

Added:
   trunk/docs/Iteracao7-CB06/
   trunk/docs/Iteracao7-CB06/Iteracao7.txt
   trunk/docs/Iteracao8-CB08/
   trunk/docs/Iteracao8-CB08/Iteracao8.txt
Removed:
   trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/Type.hbm.xml
   trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/Type.java
   trunk/spikes/Prototipos/src/de/berlios/kcookb/imagens/Thumbs.db
Modified:
   trunk/docs/Iteracao4-CB04/Iteracao 4.txt
   trunk/docs/Iteracao6-CB07/exemplo.xml
   trunk/docs/TODO
   trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/DiskGroup.java
   trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/Media.hbm.xml
   trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/Media.java
   trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/hibernate.general.cfg.xml
   trunk/project/JFindMyFiles/ExportEngine/src/de/berlios/jfindmyfiles/exportengine/XML.java
   trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/ActiveScanningDlg.form
   trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/ActiveScanningDlg.java
   trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/Bundle.properties
   trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/ExportDlg.form
   trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/ExportDlg.java
   trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/NewDiskDlg.java
   trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/nodes/DiskNode.java
   trunk/project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles/MediaReader.java
Log:
Adicionados documentos para as pr?\195?\179ximas itera?\195?\167?\195?\181es.
Implementado o sistema de exporta?\195?\167?\195?\163o para XML.

Corrigidos alguns promenores nas entidades.

Modified: trunk/docs/Iteracao4-CB04/Iteracao 4.txt
===================================================================
--- trunk/docs/Iteracao4-CB04/Iteracao 4.txt	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/docs/Iteracao4-CB04/Iteracao 4.txt	2008-06-12 01:17:02 UTC (rev 144)
@@ -25,4 +25,14 @@
 como pertencentes a express&#231;&#245;es regulares, o asterisco, *, e o ponto de 
 interroga&#231;&#227;o, ?.
 NOTA:::::: O sistema hibernate faz o mesmo que estes caracteres atrav&#233;s do padar&#227;o de matching!!!!
+
+N&#227;o ser&#225; poss&#237;vel saber se um ficheiro existe sem o tentar abrir, ou pelo menos 
+sem criar um objecto do tipo File e usar os seus m&#233;todos para verificar a 
+exist&#234;ncia do ficheiro. Assim, n&#227;o ser&#225; poss&#237;vel activar ou desactivar a op&#231;&#227;o 
+de abrir um determinado ficheiro quando o mesmo est&#225; dispon&#237;vel ou indispon&#237;vel.
+Esta op&#231;&#227;o ser&#225; implementada de outra forma, em vez de activar ou desactivar as 
+interfaces com o utilizador dependendo da disponibilidade dos ficheiros, as 
+op&#231;&#245;es estar&#227;o sempre dispon&#237;veis, sendo que, quando o utilizador tentar abrir 
+um determinado ficheiro, &#233; verificado se o ficheiro se encontra ou n&#227;o presente 
+para ser aberto.
 &lt;==== Avalia&#231;&#227;o ===============================================================&gt;

Modified: trunk/docs/Iteracao6-CB07/exemplo.xml
===================================================================
--- trunk/docs/Iteracao6-CB07/exemplo.xml	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/docs/Iteracao6-CB07/exemplo.xml	2008-06-12 01:17:02 UTC (rev 144)
@@ -1,4 +1,3 @@
-
 &lt;catalog&gt;
     &lt;name&gt;&lt;/name&gt;
     &lt;creation-date&gt;&lt;/creation-date&gt;
@@ -6,26 +5,6 @@
     &lt;total-size&gt;&lt;/total-size&gt;
     &lt;disk-number&gt;&lt;/disk-number&gt;
     &lt;total-folders&gt;&lt;/total-folders&gt;
-    &lt;file-list&gt;
-        &lt;file id=&quot;&quot;&gt;
-            &lt;name&gt;&lt;/name&gt;
-            &lt;absolute-path&gt;&lt;/absolute-path&gt;
-            &lt;last-modified&gt;&lt;/last-modified&gt;
-            &lt;description&gt;&lt;/description&gt;
-            &lt;hidden&gt;&lt;!-- true/false --&gt;
-            &lt;/hidden&gt;
-            &lt;size&gt;&lt;/size&gt;
-            &lt;extension&gt;&lt;/extension&gt;
-            &lt;image-thumb&gt;&lt;/image-thumb&gt;
-            &lt;video-preview&gt;&lt;/video-preview&gt;
-            &lt;audio-clip&gt;&lt;/audio-clip&gt;
-            &lt;is-file&gt;&lt;/is-file&gt;
-            &lt;children&gt;&lt;!-- file items --&gt;
-            &lt;/children&gt;
-            &lt;parent-id&gt;&lt;/parent-id&gt;
-            &lt;media-id&gt;&lt;/media-id&gt;
-        &lt;/file&gt;
-    &lt;/file-list&gt;
     &lt;label-list&gt;
         &lt;label id=&quot;&quot;&gt;
             &lt;name&gt;&lt;/name&gt;
@@ -41,14 +20,6 @@
             &lt;parent-id&gt;&lt;/parent-id&gt;
         &lt;/group&gt;
     &lt;/group-list&gt;
-    &lt;loan-list&gt;
-        &lt;loan id=&quot;&quot;&gt;
-            &lt;date-loaned&gt;&lt;/date-loaned&gt;
-            &lt;date-returned&gt;&lt;/date-returned&gt;
-            &lt;user-id&gt;&lt;/user-id&gt;
-            &lt;media-id&gt;&lt;/media-id&gt;
-        &lt;/loan&gt;
-    &lt;/loan-list&gt;
     &lt;media-list&gt;
         &lt;media id=&quot;&quot;&gt;
             &lt;name&gt;&lt;/name&gt;
@@ -61,20 +32,42 @@
             &lt;/files&gt;
             &lt;labels&gt;&lt;!-- ids separdos por ponto e virgula --&gt;
             &lt;/labels&gt;
-            &lt;type-id&gt;&lt;/type-id&gt;
+            &lt;type&gt;&lt;/type&gt;
         &lt;/media&gt;
     &lt;/media-list&gt;
-    &lt;type-list&gt;
-        &lt;type id=&quot;&quot;&gt;
+    &lt;file-list&gt;
+        &lt;file id=&quot;&quot;&gt;
             &lt;name&gt;&lt;/name&gt;
-        &lt;/type&gt;
-    &lt;/type-list&gt;
+            &lt;absolute-path&gt;&lt;/absolute-path&gt;
+            &lt;last-modified&gt;&lt;/last-modified&gt;
+            &lt;description&gt;&lt;/description&gt;
+            &lt;hidden&gt;&lt;!-- true/false --&gt;
+            &lt;/hidden&gt;
+            &lt;size&gt;&lt;/size&gt;
+            &lt;extension&gt;&lt;/extension&gt;
+            &lt;image-thumb&gt;&lt;/image-thumb&gt;
+            &lt;video-preview&gt;&lt;/video-preview&gt;
+            &lt;audio-clip&gt;&lt;/audio-clip&gt;
+            &lt;is-file&gt;&lt;/is-file&gt;
+            &lt;children&gt;&lt;!-- file items --&gt;
+            &lt;/children&gt;
+            &lt;parent-id&gt;&lt;/parent-id&gt;
+            &lt;media-id&gt;&lt;/media-id&gt;
+        &lt;/file&gt;
+    &lt;/file-list&gt;
     &lt;user-list&gt;
         &lt;user id=&quot;&quot;&gt;
-            &lt;first-name&gt;&lt;/first-name&gt;
-            &lt;loans&gt;&lt;!-- ids separdos por ponto e virgula --&gt;
-            &lt;/loans&gt;
-            &lt;surname&gt;&lt;/surname&gt;
+            &lt;firstname&gt;&lt;/firstname&gt;
+			&lt;surname&gt;&lt;/surname&gt;
+            &lt;!-- &lt;loans&gt;&lt;!-- ids separdos por ponto e virgula --&gt; &lt;!--  &lt;/loans&gt; --&gt;
         &lt;/user&gt;
     &lt;/user-list&gt;
+    &lt;loan-list&gt;
+        &lt;loan id=&quot;&quot;&gt;
+            &lt;loaned-date&gt;&lt;/loaned-date&gt;
+            &lt;returned-date&gt;&lt;/returned-date&gt;
+            &lt;user-id&gt;&lt;/user-id&gt;
+            &lt;media-id&gt;&lt;/media-id&gt;
+        &lt;/loan&gt;
+    &lt;/loan-list&gt;
 &lt;/catalog&gt;
\ No newline at end of file

Added: trunk/docs/Iteracao7-CB06/Iteracao7.txt
===================================================================
--- trunk/docs/Iteracao7-CB06/Iteracao7.txt	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/docs/Iteracao7-CB06/Iteracao7.txt	2008-06-12 01:17:02 UTC (rev 144)
@@ -0,0 +1,10 @@
+&lt;==== Objectivos ==============================================================&gt;
+CB06: ST11
+- Quero exportar um cat&#195;&#161;logo completo ou um subconjunto para um conjunto de 
+ficheiros HTML que possam ser colocados on-line ou distribu&#195;&#173;dos livremente.
+Devem existir personaliza&#195;&#167;&#195;&#181;es de aspecto que se possam aplicar aos ficheiros 
+criados.
+&lt;==== Documentos produzidos ===================================================&gt;
+Nenhum
+&lt;====
+&lt;==== Avalia&#195;&#167;&#195;&#163;o ===============================================================&gt;

Added: trunk/docs/Iteracao8-CB08/Iteracao8.txt
===================================================================
--- trunk/docs/Iteracao8-CB08/Iteracao8.txt	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/docs/Iteracao8-CB08/Iteracao8.txt	2008-06-12 01:17:02 UTC (rev 144)
@@ -0,0 +1,9 @@
+&lt;==== Objectivos ==============================================================&gt;
+CB08: ST8
+- Sistema de estat&#195;&#173;sticas que mostre dados relevantes sobre os ficheiros 
+existentes como o n&#195;&#186;mero de ficheiros de determinado tipo, o tamanho m&#195;&#169;dio dos 
+ficheiros catalogados, o tamanho total ocupado, etc..
+&lt;==== Documentos produzidos ===================================================&gt;
+Nenhum
+&lt;====
+&lt;==== Avalia&#195;&#167;&#195;&#163;o ===============================================================&gt;

Modified: trunk/docs/TODO
===================================================================
--- trunk/docs/TODO	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/docs/TODO	2008-06-12 01:17:02 UTC (rev 144)
@@ -17,7 +17,6 @@
 	- Abrir cat&#225;logo
 	- Fechar cat&#225;logo
 	- Manter registo de cat&#225;logos recentes
-	- OpenCatalogDlg - Janela de di&#225;logo que permite abrir cat&#225;logos existentes.
 - Menus:?
 	
 Itera&#231;&#227;o 3:
@@ -31,7 +30,6 @@
 	- menus de contexto sens&#237;veis
 
 Itera&#231;&#227;o 6:
-	- exportar dados para XML
 	- exportar dados para CSV
 	- importar dados de XML
 	- importar dados de outra base de dados

Modified: trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/DiskGroup.java
===================================================================
--- trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/DiskGroup.java	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/DiskGroup.java	2008-06-12 01:17:02 UTC (rev 144)
@@ -19,7 +19,9 @@
  */
 package de.berlios.jfindmyfiles.catalog.entities;
 
+import java.util.ArrayList;
 import java.util.LinkedHashSet;
+import java.util.List;
 import java.util.Set;
 
 /**
@@ -61,6 +63,14 @@
             groups.remove(child);
         }
     }
+    
+    public List&lt;DiskGroup&gt; getGroupList() {
+        ArrayList&lt;DiskGroup&gt; temp = new ArrayList&lt;DiskGroup&gt;(groups.size());
+        for(Object o : groups) {
+            temp.add((DiskGroup)o);
+        }
+        return temp;
+    }
 
     @SuppressWarnings(&quot;unchecked&quot;)
     public void addDisk(Media media) {
@@ -77,6 +87,14 @@
         }
     }
 
+    public List getDiskList() {
+        ArrayList&lt;Media&gt; temp = new ArrayList&lt;Media&gt;(groups.size());
+        for(Object o : groups) {
+            temp.add((Media)o);
+        }
+        return temp;
+    }    
+    
     public void increaseCapacity(long amount) {
         capacity += amount;
     }

Modified: trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/Media.hbm.xml
===================================================================
--- trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/Media.hbm.xml	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/Media.hbm.xml	2008-06-12 01:17:02 UTC (rev 144)
@@ -32,6 +32,8 @@
         &lt;property name=&quot;description&quot;/&gt;
         &lt;property name=&quot;freeSpace&quot;/&gt;
         &lt;property name=&quot;location&quot;/&gt;
+        &lt;property name=&quot;type&quot;/&gt;
+        
         &lt;set name=&quot;loans&quot; table=&quot;TBL_LOANS&quot; inverse=&quot;true&quot;&gt;
             &lt;key column=&quot;MEDIA_ID&quot;/&gt;
             &lt;one-to-many class=&quot;de.berlios.jfindmyfiles.catalog.entities.Loan&quot;/&gt;
@@ -43,9 +45,7 @@
         &lt;set name=&quot;files&quot; inverse=&quot;true&quot;&gt;
             &lt;key column=&quot;MEDIA_ID&quot;/&gt;
             &lt;one-to-many class=&quot;de.berlios.jfindmyfiles.catalog.entities.FileWrapper&quot;/&gt;
-        &lt;/set&gt;
-
-        &lt;many-to-one name=&quot;type&quot; class=&quot;de.berlios.jfindmyfiles.catalog.entities.Type&quot; column=&quot;TYPE_ID&quot; not-null=&quot;true&quot; lazy=&quot;false&quot;/&gt;
+        &lt;/set&gt; 
         
         &lt;join table=&quot;TBL_GROUP_MEDIA&quot; optional=&quot;true&quot;&gt;
             &lt;key column=&quot;MEDIA_ID&quot;/&gt;

Modified: trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/Media.java
===================================================================
--- trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/Media.java	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/Media.java	2008-06-12 01:17:02 UTC (rev 144)
@@ -19,7 +19,9 @@
  */
 package de.berlios.jfindmyfiles.catalog.entities;
 
+import java.util.ArrayList;
 import java.util.LinkedHashSet;
+import java.util.List;
 import java.util.Set;
 
 /**
@@ -36,12 +38,12 @@
     private String description;
     private long freeSpace;
     private String location;
+    private int type;
     //Attributes from relationships
     private Set files;
     private Set labels;
     private DiskGroup group;
     private Set loans;
-    private Type type;
 
     public Media() {
         //DO NOTHING
@@ -49,7 +51,7 @@
 
     public Media(String name, long capacity, long lastModified,
             String description, long freeSpace, String location,
-            DiskGroup group, Type type) {
+            DiskGroup group, int type) {
 
         this.name = name;
         this.capacity = capacity;
@@ -76,6 +78,14 @@
             files.remove(file);
         }
     }
+    
+    public List&lt;FileWrapper&gt; getFileList() {
+        ArrayList&lt;FileWrapper&gt; temp = new ArrayList&lt;FileWrapper&gt;(files.size());
+        for(Object o : files) {
+            temp.add((FileWrapper)o);
+        }
+        return temp;
+    }    
 
     @SuppressWarnings(&quot;unchecked&quot;)
     public void addLabel(Label label) {
@@ -91,6 +101,14 @@
         }
     }
     
+    public List&lt;Label&gt; getLabelList() {
+        ArrayList&lt;Label&gt; temp = new ArrayList&lt;Label&gt;(labels.size());
+        for(Object o : labels) {
+            temp.add((Label)o);
+        }
+        return temp;
+    }
+    
     @SuppressWarnings(&quot;unchecked&quot;)
     public void addLoan(Loan loan) {
         if (loans == null) {
@@ -104,7 +122,15 @@
             loans.remove(loan);
         }
     }
-
+    
+    public List&lt;Loan&gt; getLoanList() {
+        ArrayList&lt;Loan&gt; temp = new ArrayList&lt;Loan&gt;(loans.size());
+        for(Object o : loans) {
+            temp.add((Loan)o);
+        }
+        return temp;
+    }
+    
     public void increaseCapacity(long amount) {
         capacity += amount;
     }
@@ -168,11 +194,11 @@
     private void setLabels(Set labels) {
         this.labels = labels;
     }
-    
+
     private Set getLoans() {
         return loans;
     }
-    
+
     private void setLoans(Set loans) {
         this.loans = loans;
     }
@@ -201,11 +227,11 @@
         this.name = name;
     }
 
-    public Type getType() {
+    public int getType() {
         return type;
     }
 
-    public void setType(Type type) {
+    public void setType(int type) {
         this.type = type;
     }
 
@@ -220,7 +246,7 @@
      */
     @Override
     public boolean equals(Object obj) {
-        if(obj == null) {
+        if (obj == null) {
             return false;
         }
 
@@ -233,7 +259,7 @@
         }
 
         Media other = (Media) obj;
-        return name.equals(other.name) &amp;&amp; description.equals(other.description) &amp;&amp; type.equals(other.type);
+        return name.equals(other.name) &amp;&amp; description.equals(other.description) &amp;&amp; type == other.type;
     }
 
     /**
@@ -245,9 +271,9 @@
     @Override
     public int hashCode() {
         int hash = 7;
-        hash = 31 * hash + (this.name != null ? this.name.hashCode() : 0);
-        hash = 31 * hash + (this.description != null ? this.description.hashCode() : 0);
-        hash = 31 * hash + (this.type != null ? this.type.hashCode() : 0);
+        hash = 37 * hash + (this.name != null ? this.name.hashCode() : 0);
+        hash = 37 * hash + (this.description != null ? this.description.hashCode() : 0);
+        hash = 37 * hash + this.type;
         return hash;
     }
 

Deleted: trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/Type.hbm.xml
===================================================================
--- trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/Type.hbm.xml	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/Type.hbm.xml	2008-06-12 01:17:02 UTC (rev 144)
@@ -1,33 +0,0 @@
-&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
-&lt;!--
- *  Copyright (C) 2008  Patr&#195;&#173;cia Monteiro e S&#195;&#169;rgio Lopes
- *
- *  This file is part of JFindMyFiles.
- *
- *  JFindMyFiles is free software: you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation, either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  JFindMyFiles is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with JFindMyFiles.  If not, see 
- * &lt;<A HREF="http://www.gnu.org/licenses/gpl.html">http://www.gnu.org/licenses/gpl.html</A>&gt;.
- --&gt;
-&lt;!DOCTYPE hibernate-mapping PUBLIC 
-'PUBLIC:-//Hibernate/Hibernate Mapping DTD 3.0//EN' 
-'<A HREF="http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd</A>'&gt;
-    
-&lt;hibernate-mapping&gt;
-    &lt;class name=&quot;de.berlios.jfindmyfiles.catalog.entities.Type&quot; table=&quot;TBL_TYPE&quot;&gt;
-        &lt;id name=&quot;id&quot; column=&quot;TYPE_ID&quot;&gt;
-            &lt;generator class=&quot;native&quot;/&gt;
-        &lt;/id&gt;
-        
-        &lt;property name=&quot;name&quot;/&gt;
-    &lt;/class&gt;
-&lt;/hibernate-mapping&gt;

Deleted: trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/Type.java
===================================================================
--- trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/Type.java	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities/Type.java	2008-06-12 01:17:02 UTC (rev 144)
@@ -1,102 +0,0 @@
-/**
- *  Copyright (C) 2008  Patr&#195;&#173;cia Monteiro e S&#195;&#169;rgio Lopes
- *
- *  This file is part of JFindMyFiles.
- *
- *  JFindMyFiles is free software: you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation, either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  JFindMyFiles is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with JFindMyFiles.  If not, see 
- * &lt;<A HREF="http://www.gnu.org/licenses/gpl.html">http://www.gnu.org/licenses/gpl.html</A>&gt;.
- */
-package de.berlios.jfindmyfiles.catalog.entities;
-
-import java.util.LinkedHashSet;
-import java.util.Set;
-
-/**
- *
- * @author ei10635
- */
-public class Type {
-
-    private long id;
-    private String name;
-
-    public Type() {
-        //DO NOTHING
-    }
-
-    public Type(String name) {
-        this.name = name;
-    }
-
-    public long getId() {
-        return id;
-    }
-
-    private void setId(long id) {
-        this.id = id;
-    }
-
-    public String getName() {
-        return name;
-    }
-
-    public void setName(String name) {
-        this.name = name;
-    }
-
-    /**
-     * Equals method doesn't take into account the id of the object. Hibernate 
-     * only gives an id to a new object when that object is persisted, it is 
-     * therefor not possible to use the id attribute.
-     * 
-     * A &lt;em&gt;Bussines Key&lt;/em&gt; is used instead.
-     * @param obj the object to compare
-     * @return true if both objects are equal under the &lt;em&gt;Bussines Key&lt;/em&gt;
-     */
-    @Override
-    public boolean equals(Object obj) {
-        if (obj == null) {
-            return false;
-        }
-        
-        if (this == obj) {
-            return true;
-        }
-
-        if (!(obj instanceof Type)) {
-            return false;
-        }
-
-        Type other = (Type) obj;
-        return name.equals(other.name);
-    }
-
-    /**
-     * HashCode for this object, excluding the id field.
-     * @return integer representing the hashcode
-     * 
-     * @see equals
-     */
-    @Override
-    public int hashCode() {
-        int hash = 7;
-        hash = 61 * hash + (this.name != null ? this.name.hashCode() : 0);
-        return hash;
-    }
-
-    @Override
-    public String toString() {
-        return name;
-    }
-}

Modified: trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/hibernate.general.cfg.xml
===================================================================
--- trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/hibernate.general.cfg.xml	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/hibernate.general.cfg.xml	2008-06-12 01:17:02 UTC (rev 144)
@@ -52,7 +52,6 @@
         &lt;mapping resource=&quot;de/berlios/jfindmyfiles/catalog/entities/Label.hbm.xml&quot;/&gt;
         &lt;mapping resource=&quot;de/berlios/jfindmyfiles/catalog/entities/Loan.hbm.xml&quot;/&gt;
         &lt;mapping resource=&quot;de/berlios/jfindmyfiles/catalog/entities/Media.hbm.xml&quot;/&gt;
-        &lt;mapping resource=&quot;de/berlios/jfindmyfiles/catalog/entities/Type.hbm.xml&quot;/&gt;
         &lt;mapping resource=&quot;de/berlios/jfindmyfiles/catalog/entities/User.hbm.xml&quot;/&gt;
         &lt;mapping resource=&quot;de/berlios/jfindmyfiles/catalog/entities/VideoData.hbm.xml&quot;/&gt;
         &lt;mapping resource=&quot;de/berlios/jfindmyfiles/catalog/entities/CatalogProperties.hbm.xml&quot;/&gt;

Modified: trunk/project/JFindMyFiles/ExportEngine/src/de/berlios/jfindmyfiles/exportengine/XML.java
===================================================================
--- trunk/project/JFindMyFiles/ExportEngine/src/de/berlios/jfindmyfiles/exportengine/XML.java	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/project/JFindMyFiles/ExportEngine/src/de/berlios/jfindmyfiles/exportengine/XML.java	2008-06-12 01:17:02 UTC (rev 144)
@@ -20,16 +20,25 @@
 package de.berlios.jfindmyfiles.exportengine;
 
 import de.berlios.jfindmyfiles.catalog.CatalogEngine;
+import de.berlios.jfindmyfiles.catalog.entities.CatalogProperties;
+import de.berlios.jfindmyfiles.catalog.entities.DiskGroup;
+import de.berlios.jfindmyfiles.catalog.entities.FileWrapper;
+import de.berlios.jfindmyfiles.catalog.entities.Label;
+import de.berlios.jfindmyfiles.catalog.entities.Loan;
+import de.berlios.jfindmyfiles.catalog.entities.Media;
+import de.berlios.jfindmyfiles.catalog.entities.User;
 import java.io.File;
 import java.io.FileNotFoundException;
 import java.io.IOException;
 import java.io.PrintWriter;
+import java.util.List;
 import javax.xml.transform.OutputKeys;
 import javax.xml.transform.Transformer;
 import javax.xml.transform.TransformerConfigurationException;
 import javax.xml.transform.sax.SAXTransformerFactory;
 import javax.xml.transform.sax.TransformerHandler;
 import javax.xml.transform.stream.StreamResult;
+import org.hibernate.Session;
 import org.openide.util.Lookup;
 import org.xml.sax.SAXException;
 import org.xml.sax.helpers.AttributesImpl;
@@ -68,142 +77,299 @@
             hd.setResult(sr);
             hd.startDocument();
             AttributesImpl atts = new AttributesImpl();
-
+            String aux;
+            List lAux;
             CatalogEngine eng = Lookup.getDefault().lookup(CatalogEngine.class);
+            Session s = eng.sessionFactory.getCurrentSession();
+            s.beginTransaction();
+            CatalogProperties props = eng.getProperties();
 
             hd.startDocument();
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;catalog&quot;, atts);//&lt;catalog&gt;
+            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;catalog&quot;, atts);
             //CATALOG INFO
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;, atts);//&lt;name&gt;
-            hd.characters(eng.getProperties().getName().toCharArray(), 0, eng.getProperties().getName().length());
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;);//&lt;/name&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;creation-date&quot;, atts);//&lt;creation-date&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;creation-date&quot;);//&lt;/creation-date&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;description&quot;, atts);//&lt;description&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;description&quot;);//&lt;/description&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;total-size&quot;, atts);//&lt;total-size&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;total-size&quot;);//&lt;/total-size&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;disk-number&quot;, atts);//&lt;disk-number&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;disk-number&quot;);//&lt;/disk-number&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;total-folders&quot;, atts);//&lt;total-folders&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;total-folders&quot;);//&lt;/total-folders&gt;
+            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;, atts);
+            aux = props.getName() != null ? props.getName() : &quot;&quot;;
+            hd.characters(aux.toCharArray(), 0, aux.length());
+            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;);
+            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;creation-date&quot;, atts);
+            aux = props.getCreationDate() != null ? String.valueOf(props.getCreationDate().getTime()) : &quot;&quot;;
+            hd.characters(aux.toCharArray(), 0, aux.length());
+            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;creation-date&quot;);
+            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;description&quot;, atts);
+            aux = props.getDescription() != null ? props.getDescription() : &quot;&quot;;
+            hd.characters(aux.toCharArray(), 0, aux.length());
+            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;description&quot;);
+            aux = String.valueOf(props.getTotalSize());
+            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;total-size&quot;, atts);
+            hd.characters(aux.toCharArray(), 0, aux.length());
+            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;total-size&quot;);
+            aux = String.valueOf(props.getDiskNumber());
+            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;disk-number&quot;, atts);
+            hd.characters(aux.toCharArray(), 0, aux.length());
+            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;disk-number&quot;);
+            aux = String.valueOf(props.getTotalFolders());
+            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;total-folders&quot;, atts);
+            hd.characters(aux.toCharArray(), 0, aux.length());
+            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;total-folders&quot;);
             //END CATALOG INFO
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;file-list&quot;, atts);//&lt;file-list&gt;
-            //START FILE LIST
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;file&quot;, atts);//&lt;file id=&quot;&quot;&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;, atts);//&lt;name&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;);//&lt;/name&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;absolute-path&quot;, atts);//&lt;absolute-path&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;absolute-path&quot;);//&lt;/absolute-path&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;last-modified&quot;, atts);//&lt;last-modified&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;last-modified&quot;);//&lt;/last-modified&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;description&quot;, atts);//&lt;description&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;description&quot;);//&lt;/description&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;hidden&quot;, atts);//&lt;hidden&gt;&lt;!-- true/false --&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;hidden&quot;);//&lt;/hidden&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;size&quot;, atts);//&lt;size&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;size&quot;);//&lt;/size&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;extension&quot;, atts);//&lt;extension&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;extension&quot;);//&lt;/extension&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;image-thumb&quot;, atts);//&lt;image-thumb&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;image-thumb&quot;);//&lt;/image-thumb&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;video-preview&quot;, atts);//&lt;video-preview&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;video-preview&quot;);//&lt;/video-preview&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;audio-clip&quot;, atts);//&lt;audio-clip&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;audio-clip&quot;);//&lt;/audio-clip&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;is-file&quot;, atts);//&lt;is-file&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;is-file&quot;);//&lt;/is-file&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;children&quot;, atts);//&lt;children&gt;&lt;!-- file items --&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;children&quot;);//&lt;/children&gt;//TODO: ?
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;parent-id&quot;, atts);//&lt;parent-id&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;parent-id&quot;);//&lt;/parent-id&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;media-id&quot;, atts);//&lt;media-id&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;media-id&quot;);//&lt;/media-id&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;&quot;);//&lt;/file&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;file-list&quot;);//&lt;/file-list
-            //END FILE LIST
-            //TODO: atts
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;label-list&quot;, atts);//&lt;label-list&gt;
             //START LABEL LIST
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;label&quot;, atts);//&lt;label id=&quot;&quot;&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;, atts);//&lt;name&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;);//&lt;/name&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;label&quot;);//&lt;/label&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;label-list&quot;);//&lt;/label-list&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;group-list&quot;, atts);//&lt;group-list&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;group&quot;, atts);//&lt;group id=&quot;&quot;&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;, atts);//&lt;name&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;);//&lt;/name&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;description&quot;, atts);//&lt;description&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;description&quot;);//&lt;/description&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;capacity&quot;, atts);//&lt;capacity&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;capacity&quot;);//&lt;/capacity&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;groups&quot;, atts);//&lt;groups&gt; &lt; !--ids separdos por ponto e virgula --&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;groups&quot;);//&lt;/groups&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;parent-id&quot;, atts);//&lt;parent-id&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;parent-id&quot;);//&lt;/parent-id&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;group&quot;);//&lt;/group&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;group-list&quot;);//&lt;/group-list&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;loan-list&quot;, atts);//&lt;loan-list&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;loan&quot;, atts);//&lt;loan id=&quot;&quot;&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;loaned-date&quot;, atts);//&lt;loaned-date &gt; 
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;loaned-date&quot;);//&lt;/loaned-date&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;returned-date&quot;, atts);//&lt;returned-date&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;returned-date&quot;);//&lt;/returned-date&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;user-id&quot;, atts);//&lt;user-id &gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;user-id&quot;);//&lt;/user-id &gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;media-id&quot;, atts);//&lt;media-id &gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;media-id&quot;);//&lt;/media-id &gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;loan&quot;, atts);//&lt;/loan&gt; 
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;loan-list&quot;);//&lt;/loan-list&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;media-list&quot;, atts);//&lt;media-list&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;media&quot;, atts);//&lt;media id=&quot;&quot;&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;, atts);//&lt;name&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;);//&lt;/name&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;capacity&quot;, atts);//&lt;capacity&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;capacity&quot;);//&lt;/capacity&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;last-modified&quot;, atts);//&lt;last-modified&gt; 
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;last-modified&quot;);//&lt;/last-modified&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;description&quot;, atts);//&lt;description&gt;
+            lAux = s.createQuery(&quot;from Label&quot;).list();
+            if (lAux != null) {
+                hd.startElement(&quot;&quot;, &quot;&quot;, &quot;label-list&quot;, atts);
+                for (Object l : lAux) {
+                    atts.clear();
+                    atts.addAttribute(&quot;&quot;, &quot;&quot;, &quot;id&quot;, &quot;CDATA&quot;, String.valueOf(((Label) l).getId()));
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;label&quot;, atts);
+                    atts.clear();
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;, atts);
+                    aux = ((Label) l).getName() != null ? ((Label) l).getName() : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;label&quot;);
+                }
+                hd.endElement(&quot;&quot;, &quot;&quot;, &quot;label-list&quot;);
+            }
+            //END LABEL LIST
+            //START GROUP LIST
+            lAux = s.createQuery(&quot;from DiskGroup&quot;).list();
+            if (lAux != null) {
+                hd.startElement(&quot;&quot;, &quot;&quot;, &quot;group-list&quot;, atts);
+                DiskGroup g;
+                for (Object l : lAux) {
+                    atts.clear();
+                    g = (DiskGroup) l;
+                    atts.addAttribute(&quot;&quot;, &quot;&quot;, &quot;id&quot;, &quot;CDATA&quot;, String.valueOf(g.getId()));
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;group&quot;, atts);
+                    atts.clear();
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;, atts);
+                    aux = g.getName() != null ? g.getName() : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;description&quot;, atts);
+                    aux = g.getDescription() != null ? g.getDescription() : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;description&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;capacity&quot;, atts);
+                    aux = String.valueOf(g.getCapacity());
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;capacity&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;groups&quot;, atts);//ids separdos por ponto e virgula
 
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;description&quot;);//&lt;/description&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;free-space&quot;, atts);//&lt;free-space&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;free-space&quot;);// &lt;/free-space&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;location&quot;, atts);//&lt;location&gt;
+                    aux = &quot;&quot;;
+                    for (DiskGroup g2 : g.getGroupList()) {
+                        aux += g2.getId() + &quot;;&quot;;
+                    }
+                    if (aux.length() &gt; 1) {
+                        aux = aux.substring(0, aux.length() - 2);
+                    }
 
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;location&quot;);//&lt;/location&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;files&quot;, atts);//&lt;files&gt; &lt; !--ids separdos por ponto e virgula --&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;/files&quot;);//&lt;/files&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;labels&quot;, atts);//&lt;labels&gt; ids separdos por ponto e virgula
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;labels&quot;);//&lt;/labels&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;type-id&quot;, atts);//&lt;type-id&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;type-id&quot;);//&lt;/type-id&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;media&quot;);//&lt;/media&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;media-list&quot;);//&lt;/media-list&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;type-list&quot;, atts);//&lt;type-list&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;type&quot;, atts);//&lt;type id=&quot;&quot;&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;naeme&quot;, atts);//&lt;name&gt;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;groups&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;parent-id&quot;, atts);
+                    aux = g.getParent() != null ? String.valueOf(g.getParent().getId()) : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;parent-id&quot;);
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;group&quot;);
+                }
+                hd.endElement(&quot;&quot;, &quot;&quot;, &quot;group-list&quot;);
+            }
+            //END GROUP LIST
+            //START MEDIA LIST
+            lAux = s.createQuery(&quot;from Media&quot;).list();
+            if (lAux != null) {
+                hd.startElement(&quot;&quot;, &quot;&quot;, &quot;media-list&quot;, atts);
+                Media m;
+                for (Object l : lAux) {
+                    m = (Media) l;
+                    atts.clear();
+                    atts.addAttribute(&quot;&quot;, &quot;&quot;, &quot;id&quot;, &quot;CDATA&quot;, String.valueOf(m.getId()));
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;media&quot;, atts);
+                    atts.clear();
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;, atts);
+                    aux = m.getName() != null ? m.getName() : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;capacity&quot;, atts);
+                    aux = String.valueOf(m.getCapacity());
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;capacity&quot;);
 
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;);//&lt;/name&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;type&quot;, atts);//&lt;/type&gt; 
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;type-list&quot;);//&lt;/type-list&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;user-list&quot;, atts);//&lt;user-list&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;user&quot;, atts);//&lt;user  id=&quot;&quot;&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;firstname&quot;, atts);//&lt;firstname&gt; 
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;last-modified&quot;, atts);
+                    aux = String.valueOf(m.getLastModified());
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;last-modified&quot;);
 
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;firstname&quot;);//&lt;/firstname&gt;
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;surname&quot;, atts);//&lt;surname&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;surname&quot;);//&lt;/surname&gt;
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;description&quot;, atts);
+                    aux = m.getDescription() != null ? m.getDescription() : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;description&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;free-space&quot;, atts);
+                    aux = String.valueOf(m.getFreeSpace());
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;free-space&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;location&quot;, atts);
+                    aux = m.getLocation() != null ? m.getLocation() : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;location&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;files&quot;, atts);//ids separdos por ponto e virgula
 
-            hd.startElement(&quot;&quot;, &quot;&quot;, &quot;loans&quot;, atts);//&lt;loans&gt; &lt; !--ids separdos por ponto e virgula --&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;loans&quot;);//&lt;/loans&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;user&quot;);//&lt;/user&gt;
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;user-list&quot;);//&lt;/user-list&gt;
-            //END TOP LEVEL
-            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;catalog&quot;);//&lt;/catalog&gt;
+                    aux = &quot;&quot;;
+                    for (FileWrapper f : m.getFileList()) {
+                        aux += f.getId() + &quot;;&quot;;
+                    }
+                    if (aux.length() &gt; 1) {
+                        aux = aux.substring(0, aux.length() - 2);
+                    }
+
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;files&quot;);
+
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;labels&quot;, atts);//ids separdos por ponto e virgula
+                    aux = &quot;&quot;;
+                    for (Label l2 : m.getLabelList()) {
+                        aux += l2.getId() + &quot;;&quot;;
+                    }
+                    if (aux.length() &gt; 1) {
+                        aux = aux.substring(0, aux.length() - 2);
+                    }
+
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;labels&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;type&quot;, atts);
+                    aux = String.valueOf(m.getType());
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;type&quot;);
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;media&quot;);
+                }
+                hd.endElement(&quot;&quot;, &quot;&quot;, &quot;media-list&quot;);
+            }
+            //END MEDIA LIST
+            //START FILE LIST
+            lAux = s.createQuery(&quot;from FileWrapper&quot;).list();
+            if (lAux != null) {
+                hd.startElement(&quot;&quot;, &quot;&quot;, &quot;file-list&quot;, atts);
+                FileWrapper f;
+                for (Object l : lAux) {
+                    f = (FileWrapper) l;
+                    atts.clear();
+                    atts.addAttribute(&quot;&quot;, &quot;&quot;, &quot;id&quot;, &quot;CDATA&quot;, String.valueOf(f.getId()));
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;file&quot;, atts);
+                    atts.clear();
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;, atts);
+                    aux = f.getName() != null ? f.getName() : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;name&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;absolute-path&quot;, atts);
+                    aux = f.getAbsolutePath() != null ? f.getAbsolutePath() : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;absolute-path&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;last-modified&quot;, atts);
+                    aux = String.valueOf(f.getLastModified());
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;last-modified&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;description&quot;, atts);
+                    aux = f.getDescription() != null ? f.getDescription() : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;hidden&quot;, atts);
+                    aux = String.valueOf(f.isHidden());
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;hidden&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;size&quot;, atts);
+                    aux = String.valueOf(f.getSize());
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;size&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;extension&quot;, atts);
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;extension&quot;);
+                    //TODO: image, video and audio data
+                    //hd.startElement(&quot;&quot;, &quot;&quot;, &quot;&quot;, atts);&lt;image-thumb&gt;&lt;/image-thumb&gt;
+                    //hd.startElement(&quot;&quot;, &quot;&quot;, &quot;&quot;, atts);&lt;video-preview&gt;&lt;/video-preview&gt;
+                    //hd.startElement(&quot;&quot;, &quot;&quot;, &quot;&quot;, atts);&lt;audio-clip&gt;&lt;/audio-clip&gt;
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;is-file&quot;, atts);
+                    aux = String.valueOf(f.isFile());
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;is-file&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;sha1&quot;, atts);
+                    aux = f.getSha1() != null ? f.getSha1() : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;sha1&quot;);
+
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;children&quot;, atts);//ids separados por ponto e virgula
+                    //TODO:
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;children&quot;);
+
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;parent-id&quot;, atts);
+                    aux = f.getParent() != null ? String.valueOf(f.getParent().getId()) : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;parent-id&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;media-id&quot;, atts);
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;media-id&quot;);
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;file&quot;);
+                }
+                hd.endElement(&quot;&quot;, &quot;&quot;, &quot;file-list&quot;);
+            }
+            //END FILE LIST
+            //START USER LIST
+            lAux = s.createQuery(&quot;from User&quot;).list();
+            if (lAux != null) {
+                hd.startElement(&quot;&quot;, &quot;&quot;, &quot;user-list&quot;, atts);
+                User u;
+                for (Object o : lAux) {
+                    u = (User) o;
+                    atts.clear();
+                    atts.addAttribute(&quot;&quot;, &quot;&quot;, &quot;id&quot;, &quot;CDATA&quot;, String.valueOf(u.getId()));
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;user&quot;, atts);
+                    atts.clear();
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;firstname&quot;, atts);
+                    aux = u.getFirstname() != null ? u.getFirstname() : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;firstname&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;surname&quot;, atts);
+                    aux = u.getSurname() != null ? u.getSurname() : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;surname&quot;);
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;user&quot;);
+                }
+                hd.endElement(&quot;&quot;, &quot;&quot;, &quot;user-list&quot;);
+            }
+            //END USER LIST
+            //START LOAN LIST
+            lAux = s.createQuery(&quot;from Loan&quot;).list();
+            if (lAux != null) {
+                hd.startElement(&quot;&quot;, &quot;&quot;, &quot;loan-list&quot;, atts);
+                Loan l;
+                for (Object o : lAux) {
+                    l = (Loan) o;
+                    atts.clear();
+                    atts.addAttribute(&quot;&quot;, &quot;&quot;, &quot;id&quot;, &quot;CDATA&quot;, String.valueOf(l.getId()));
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;loan&quot;, atts);
+                    atts.clear();
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;loaned-date&quot;, atts);
+                    aux = l.getLoaned() != null ? String.valueOf(l.getLoaned().getTime()) : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;loaned-date&quot;);
+
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;returned-date&quot;, atts);
+                    aux = l.getReturned() != null ? String.valueOf(l.getReturned().getTime()) : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;returned-date&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;user-id&quot;, atts);
+                    aux = l.getLoanee() != null ? String.valueOf(l.getLoanee().getId()) : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;user-id&quot;);
+                    hd.startElement(&quot;&quot;, &quot;&quot;, &quot;media-id&quot;, atts);
+                    aux = l.getMedia() != null ? String.valueOf(l.getMedia().getId()) : &quot;&quot;;
+                    hd.characters(aux.toCharArray(), 0, aux.length());
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;media-id&quot;);
+                    hd.endElement(&quot;&quot;, &quot;&quot;, &quot;loan&quot;);
+                }
+                hd.endElement(&quot;&quot;, &quot;&quot;, &quot;loan-list&quot;);
+            }
+            //END LOAN LIST            
+            hd.endElement(&quot;&quot;, &quot;&quot;, &quot;catalog&quot;);
+            //END CATALOG
             hd.endDocument();
-            sr.getOutputStream().flush();
-
+            s.getTransaction().commit();
             fireExportFinished();
         } catch (FileNotFoundException ex) {
             fireExportError();
@@ -213,14 +379,6 @@
             fireExportError();
         } catch (SAXException ex) {
             fireExportError();
-        } finally {
-            try {
-                if (sr != null) {
-                    sr.getOutputStream().close();
-                }
-            } catch (Exception ex) {
-                //IGNORE
-            }
         }
     }
 }

Modified: trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/ActiveScanningDlg.form
===================================================================
--- trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/ActiveScanningDlg.form	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/ActiveScanningDlg.form	2008-06-12 01:17:02 UTC (rev 144)
@@ -3,6 +3,8 @@
 &lt;Form version=&quot;1.5&quot; maxVersion=&quot;1.5&quot; type=&quot;org.netbeans.modules.form.forminfo.JDialogFormInfo&quot;&gt;
   &lt;Properties&gt;
     &lt;Property name=&quot;defaultCloseOperation&quot; type=&quot;int&quot; value=&quot;2&quot;/&gt;
+    &lt;Property name=&quot;resizable&quot; type=&quot;boolean&quot; value=&quot;false&quot;/&gt;
+    &lt;Property name=&quot;undecorated&quot; type=&quot;boolean&quot; value=&quot;true&quot;/&gt;
   &lt;/Properties&gt;
   &lt;SyntheticProperties&gt;
     &lt;SyntheticProperty name=&quot;formSizePolicy&quot; type=&quot;int&quot; value=&quot;1&quot;/&gt;
@@ -21,22 +23,22 @@
   &lt;Layout&gt;
     &lt;DimensionLayout dim=&quot;0&quot;&gt;
       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-          &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
+          &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
               &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Component id=&quot;jpbReadingProgress&quot; pref=&quot;295&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;jpbReadingProgress&quot; min=&quot;-2&quot; pref=&quot;297&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
               &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Component id=&quot;jbtnCancel&quot; min=&quot;-2&quot; pref=&quot;25&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;Component id=&quot;jbtnCancel&quot; min=&quot;-2&quot; pref=&quot;20&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+              &lt;EmptySpace max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
       &lt;/Group&gt;
     &lt;/DimensionLayout&gt;
     &lt;DimensionLayout dim=&quot;1&quot;&gt;
       &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-          &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
+          &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
               &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-              &lt;Group type=&quot;103&quot; groupAlignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
-                  &lt;Component id=&quot;jpbReadingProgress&quot; alignment=&quot;0&quot; pref=&quot;25&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
-                  &lt;Component id=&quot;jbtnCancel&quot; alignment=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;1&quot;/&gt;
+              &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Component id=&quot;jbtnCancel&quot; alignment=&quot;0&quot; min=&quot;-2&quot; pref=&quot;19&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
+                  &lt;Component id=&quot;jpbReadingProgress&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;1&quot;/&gt;
               &lt;/Group&gt;
               &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
           &lt;/Group&gt;
@@ -47,6 +49,10 @@
     &lt;Component class=&quot;javax.swing.JProgressBar&quot; name=&quot;jpbReadingProgress&quot;&gt;
       &lt;Properties&gt;
         &lt;Property name=&quot;indeterminate&quot; type=&quot;boolean&quot; value=&quot;true&quot;/&gt;
+        &lt;Property name=&quot;string&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+          &lt;ResourceString bundle=&quot;de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/Bundle.properties&quot; key=&quot;ActiveScanningDlg.jpbReadingProgress.string&quot; replaceFormat=&quot;org.openide.util.NbBundle.getMessage({sourceFileName}.class, &quot;{key}&quot;)&quot;/&gt;
+        &lt;/Property&gt;
+        &lt;Property name=&quot;stringPainted&quot; type=&quot;boolean&quot; value=&quot;true&quot;/&gt;
       &lt;/Properties&gt;
     &lt;/Component&gt;
     &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;jbtnCancel&quot;&gt;
@@ -57,6 +63,19 @@
         &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
           &lt;ResourceString bundle=&quot;de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/Bundle.properties&quot; key=&quot;ActiveScanningDlg.jbtnCancel.text&quot; replaceFormat=&quot;org.openide.util.NbBundle.getMessage({sourceFileName}.class, &quot;{key}&quot;)&quot;/&gt;
         &lt;/Property&gt;
+        &lt;Property name=&quot;focusPainted&quot; type=&quot;boolean&quot; value=&quot;false&quot;/&gt;
+        &lt;Property name=&quot;margin&quot; type=&quot;java.awt.Insets&quot; editor=&quot;org.netbeans.beaninfo.editors.InsetsEditor&quot;&gt;
+          &lt;Insets value=&quot;[0, 0, 0, 0]&quot;/&gt;
+        &lt;/Property&gt;
+        &lt;Property name=&quot;maximumSize&quot; type=&quot;java.awt.Dimension&quot; editor=&quot;org.netbeans.beaninfo.editors.DimensionEditor&quot;&gt;
+          &lt;Dimension value=&quot;[20, 19]&quot;/&gt;
+        &lt;/Property&gt;
+        &lt;Property name=&quot;minimumSize&quot; type=&quot;java.awt.Dimension&quot; editor=&quot;org.netbeans.beaninfo.editors.DimensionEditor&quot;&gt;
+          &lt;Dimension value=&quot;[20, 19]&quot;/&gt;
+        &lt;/Property&gt;
+        &lt;Property name=&quot;preferredSize&quot; type=&quot;java.awt.Dimension&quot; editor=&quot;org.netbeans.beaninfo.editors.DimensionEditor&quot;&gt;
+          &lt;Dimension value=&quot;[20, 19]&quot;/&gt;
+        &lt;/Property&gt;
       &lt;/Properties&gt;
       &lt;Events&gt;
         &lt;EventHandler event=&quot;actionPerformed&quot; listener=&quot;java.awt.event.ActionListener&quot; parameters=&quot;java.awt.event.ActionEvent&quot; handler=&quot;jbtnCancelActionPerformed&quot;/&gt;

Modified: trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/ActiveScanningDlg.java
===================================================================
--- trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/ActiveScanningDlg.java	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/ActiveScanningDlg.java	2008-06-12 01:17:02 UTC (rev 144)
@@ -54,11 +54,20 @@
         jbtnCancel = new javax.swing.JButton();
 
         setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
+        setResizable(false);
+        setUndecorated(true);
 
         jpbReadingProgress.setIndeterminate(true);
+        jpbReadingProgress.setString(org.openide.util.NbBundle.getMessage(ActiveScanningDlg.class, &quot;ActiveScanningDlg.jpbReadingProgress.string&quot;)); // NOI18N
+        jpbReadingProgress.setStringPainted(true);
 
         jbtnCancel.setIcon(new javax.swing.ImageIcon(getClass().getResource(&quot;/de/berlios/jfindmyfiles/jfindmyfilesgui/resources/images/x16/button-stop.png&quot;))); // NOI18N
         jbtnCancel.setText(org.openide.util.NbBundle.getMessage(ActiveScanningDlg.class, &quot;ActiveScanningDlg.jbtnCancel.text&quot;)); // NOI18N
+        jbtnCancel.setFocusPainted(false);
+        jbtnCancel.setMargin(new java.awt.Insets(0, 0, 0, 0));
+        jbtnCancel.setMaximumSize(new java.awt.Dimension(20, 19));
+        jbtnCancel.setMinimumSize(new java.awt.Dimension(20, 19));
+        jbtnCancel.setPreferredSize(new java.awt.Dimension(20, 19));
         jbtnCancel.addActionListener(new java.awt.event.ActionListener() {
             public void actionPerformed(java.awt.event.ActionEvent evt) {
                 jbtnCancelActionPerformed(evt);
@@ -69,20 +78,20 @@
         getContentPane().setLayout(layout);
         layout.setHorizontalGroup(
             layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
-            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
+            .addGroup(layout.createSequentialGroup()
                 .addContainerGap()
-                .addComponent(jpbReadingProgress, javax.swing.GroupLayout.DEFAULT_SIZE, 295, Short.MAX_VALUE)
+                .addComponent(jpbReadingProgress, javax.swing.GroupLayout.PREFERRED_SIZE, 297, javax.swing.GroupLayout.PREFERRED_SIZE)
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
-                .addComponent(jbtnCancel, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
-                .addContainerGap())
+                .addComponent(jbtnCancel, javax.swing.GroupLayout.PREFERRED_SIZE, 20, javax.swing.GroupLayout.PREFERRED_SIZE)
+                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
         );
         layout.setVerticalGroup(
             layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
-            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
+            .addGroup(layout.createSequentialGroup()
                 .addContainerGap()
-                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
-                    .addComponent(jpbReadingProgress, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 25, Short.MAX_VALUE)
-                    .addComponent(jbtnCancel, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
+                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
+                    .addComponent(jbtnCancel, javax.swing.GroupLayout.PREFERRED_SIZE, 19, javax.swing.GroupLayout.PREFERRED_SIZE)
+                    .addComponent(jpbReadingProgress, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                 .addContainerGap())
         );
 
@@ -111,7 +120,8 @@
     }
 
     public void readingAborted(ReadingEvent evt) {
-        Lookup.getDefault().lookup(MediaReader.class).removeListener(this);
-        dispose();
+        /*Lookup.getDefault().lookup(MediaReader.class).removeListener(this);
+        dispose();*/
+        readingStopped(evt);
     }
 }

Modified: trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/Bundle.properties
===================================================================
--- trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/Bundle.properties	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/Bundle.properties	2008-06-12 01:17:02 UTC (rev 144)
@@ -129,3 +129,14 @@
 AskDescriptionDlg.jbtnOK.text=OK
 ActiveScanningDlg.jbtnCancel.text=
 ExportDlg.jpbExportProgress.string=exporting...
+ActiveScanningDlg.jpbReadingProgress.string=
+ExportDlg.jpPreview.border.title=Preview
+ExportDlg.jlblPreview.text=
+ExportDlg.jlblTemplateDestination.text=Destination:
+ExportDlg.jtfTemplateDestination.text=
+ExportDlg.jbtnTemplateBrowse.text=...
+ExportDlg.jlblSelectTemplate.text=Template:
+ExportDlg.jchkTemplateOpenAfter.text=Open after export
+ExportDlg.jchkOpenAfter.text=Open after export
+ExportDlg.jlblTemplateAuthor.text=Author:
+ExportDlg.jlblTemplateAuthorValue.text=&lt; not set &gt;

Modified: trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/ExportDlg.form
===================================================================
--- trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/ExportDlg.form	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/ExportDlg.form	2008-06-12 01:17:02 UTC (rev 144)
@@ -27,7 +27,7 @@
                   &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                       &lt;Component id=&quot;jpExportType&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;Component id=&quot;jpExportOptions&quot; pref=&quot;377&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;jpExportOptions&quot; pref=&quot;389&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
                   &lt;Group type=&quot;102&quot; alignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
                       &lt;Component id=&quot;jbtnExport&quot; linkSize=&quot;1&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
@@ -145,14 +145,19 @@
           &lt;Layout&gt;
             &lt;DimensionLayout dim=&quot;0&quot;&gt;
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                  &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
+                  &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                       &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;jlblDestination&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;Component id=&quot;jtfDestination&quot; pref=&quot;228&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                          &lt;Component id=&quot;jchkOpenAfter&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                              &lt;Component id=&quot;jtfDestination&quot; pref=&quot;240&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;Component id=&quot;jbtnBrowse&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;/Group&gt;
+                      &lt;/Group&gt;
                       &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;Component id=&quot;jbtnBrowse&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
               &lt;/Group&gt;
             &lt;/DimensionLayout&gt;
@@ -165,7 +170,9 @@
                           &lt;Component id=&quot;jbtnBrowse&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                           &lt;Component id=&quot;jtfDestination&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;/Group&gt;
-                      &lt;EmptySpace pref=&quot;266&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;jchkOpenAfter&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace pref=&quot;241&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
               &lt;/Group&gt;
             &lt;/DimensionLayout&gt;
@@ -195,6 +202,16 @@
                 &lt;EventHandler event=&quot;actionPerformed&quot; listener=&quot;java.awt.event.ActionListener&quot; parameters=&quot;java.awt.event.ActionEvent&quot; handler=&quot;jbtnBrowseActionPerformed&quot;/&gt;
               &lt;/Events&gt;
             &lt;/Component&gt;
+            &lt;Component class=&quot;javax.swing.JCheckBox&quot; name=&quot;jchkOpenAfter&quot;&gt;
+              &lt;Properties&gt;
+                &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+                  &lt;ResourceString bundle=&quot;de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/Bundle.properties&quot; key=&quot;ExportDlg.jchkOpenAfter.text&quot; replaceFormat=&quot;org.openide.util.NbBundle.getMessage({sourceFileName}.class, &quot;{key}&quot;)&quot;/&gt;
+                &lt;/Property&gt;
+              &lt;/Properties&gt;
+              &lt;Events&gt;
+                &lt;EventHandler event=&quot;stateChanged&quot; listener=&quot;javax.swing.event.ChangeListener&quot; parameters=&quot;javax.swing.event.ChangeEvent&quot; handler=&quot;jchkOpenAfterStateChanged&quot;/&gt;
+              &lt;/Events&gt;
+            &lt;/Component&gt;
           &lt;/SubComponents&gt;
         &lt;/Container&gt;
         &lt;Container class=&quot;javax.swing.JPanel&quot; name=&quot;jpTemplateExport&quot;&gt;
@@ -216,15 +233,206 @@
           &lt;Layout&gt;
             &lt;DimensionLayout dim=&quot;0&quot;&gt;
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                  &lt;EmptySpace min=&quot;0&quot; pref=&quot;361&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
+                      &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                          &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                              &lt;Component id=&quot;jpPreview&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;Component id=&quot;jpTemplateDetails&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;/Group&gt;
+                          &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                              &lt;Component id=&quot;jlblTemplateDestination&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                                  &lt;Component id=&quot;jchkTemplateOpenAfter&quot; alignment=&quot;0&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                                      &lt;Component id=&quot;jtfTemplateDestination&quot; pref=&quot;240&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                                      &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                      &lt;Component id=&quot;jbtnTemplateBrowse&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;/Group&gt;
+                              &lt;/Group&gt;
+                          &lt;/Group&gt;
+                      &lt;/Group&gt;
+                      &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;/Group&gt;
               &lt;/Group&gt;
             &lt;/DimensionLayout&gt;
             &lt;DimensionLayout dim=&quot;1&quot;&gt;
               &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-                  &lt;EmptySpace min=&quot;0&quot; pref=&quot;300&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Group type=&quot;103&quot; groupAlignment=&quot;1&quot; attributes=&quot;0&quot;&gt;
+                          &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
+                              &lt;Component id=&quot;jpPreview&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;/Group&gt;
+                          &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                              &lt;Component id=&quot;jpTemplateDetails&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;/Group&gt;
+                      &lt;/Group&gt;
+                      &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                          &lt;Component id=&quot;jlblTemplateDestination&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;jbtnTemplateBrowse&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;jtfTemplateDestination&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;/Group&gt;
+                      &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;Component id=&quot;jchkTemplateOpenAfter&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace pref=&quot;91&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;/Group&gt;
               &lt;/Group&gt;
             &lt;/DimensionLayout&gt;
           &lt;/Layout&gt;
+          &lt;SubComponents&gt;
+            &lt;Container class=&quot;javax.swing.JPanel&quot; name=&quot;jpPreview&quot;&gt;
+              &lt;Properties&gt;
+                &lt;Property name=&quot;border&quot; type=&quot;javax.swing.border.Border&quot; editor=&quot;org.netbeans.modules.form.editors2.BorderEditor&quot;&gt;
+                  &lt;Border info=&quot;org.netbeans.modules.form.compat2.border.TitledBorderInfo&quot;&gt;
+                    &lt;TitledBorder title=&quot;Preview&quot;&gt;
+                      &lt;ResourceString PropertyName=&quot;titleX&quot; bundle=&quot;de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/Bundle.properties&quot; key=&quot;ExportDlg.jpPreview.border.title&quot; replaceFormat=&quot;org.openide.util.NbBundle.getMessage({sourceFileName}.class, &quot;{key}&quot;)&quot;/&gt;
+                    &lt;/TitledBorder&gt;
+                  &lt;/Border&gt;
+                &lt;/Property&gt;
+              &lt;/Properties&gt;
+
+              &lt;Layout&gt;
+                &lt;DimensionLayout dim=&quot;0&quot;&gt;
+                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Component id=&quot;jlblPreview&quot; alignment=&quot;0&quot; pref=&quot;158&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;/Group&gt;
+                &lt;/DimensionLayout&gt;
+                &lt;DimensionLayout dim=&quot;1&quot;&gt;
+                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Component id=&quot;jlblPreview&quot; alignment=&quot;1&quot; pref=&quot;125&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                  &lt;/Group&gt;
+                &lt;/DimensionLayout&gt;
+              &lt;/Layout&gt;
+              &lt;SubComponents&gt;
+                &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jlblPreview&quot;&gt;
+                  &lt;Properties&gt;
+                    &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+                      &lt;ResourceString bundle=&quot;de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/Bundle.properties&quot; key=&quot;ExportDlg.jlblPreview.text&quot; replaceFormat=&quot;org.openide.util.NbBundle.getMessage({sourceFileName}.class, &quot;{key}&quot;)&quot;/&gt;
+                    &lt;/Property&gt;
+                    &lt;Property name=&quot;horizontalTextPosition&quot; type=&quot;int&quot; value=&quot;0&quot;/&gt;
+                  &lt;/Properties&gt;
+                &lt;/Component&gt;
+              &lt;/SubComponents&gt;
+            &lt;/Container&gt;
+            &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jlblTemplateDestination&quot;&gt;
+              &lt;Properties&gt;
+                &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+                  &lt;ResourceString bundle=&quot;de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/Bundle.properties&quot; key=&quot;ExportDlg.jlblTemplateDestination.text&quot; replaceFormat=&quot;org.openide.util.NbBundle.getMessage({sourceFileName}.class, &quot;{key}&quot;)&quot;/&gt;
+                &lt;/Property&gt;
+              &lt;/Properties&gt;
+            &lt;/Component&gt;
+            &lt;Component class=&quot;javax.swing.JTextField&quot; name=&quot;jtfTemplateDestination&quot;&gt;
+              &lt;Properties&gt;
+                &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+                  &lt;ResourceString bundle=&quot;de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/Bundle.properties&quot; key=&quot;ExportDlg.jtfTemplateDestination.text&quot; replaceFormat=&quot;org.openide.util.NbBundle.getMessage({sourceFileName}.class, &quot;{key}&quot;)&quot;/&gt;
+                &lt;/Property&gt;
+              &lt;/Properties&gt;
+            &lt;/Component&gt;
+            &lt;Component class=&quot;javax.swing.JButton&quot; name=&quot;jbtnTemplateBrowse&quot;&gt;
+              &lt;Properties&gt;
+                &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+                  &lt;ResourceString bundle=&quot;de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/Bundle.properties&quot; key=&quot;ExportDlg.jbtnTemplateBrowse.text&quot; replaceFormat=&quot;org.openide.util.NbBundle.getMessage({sourceFileName}.class, &quot;{key}&quot;)&quot;/&gt;
+                &lt;/Property&gt;
+              &lt;/Properties&gt;
+              &lt;Events&gt;
+                &lt;EventHandler event=&quot;actionPerformed&quot; listener=&quot;java.awt.event.ActionListener&quot; parameters=&quot;java.awt.event.ActionEvent&quot; handler=&quot;jbtnTemplateBrowseActionPerformed&quot;/&gt;
+              &lt;/Events&gt;
+            &lt;/Component&gt;
+            &lt;Container class=&quot;javax.swing.JPanel&quot; name=&quot;jpTemplateDetails&quot;&gt;
+
+              &lt;Layout&gt;
+                &lt;DimensionLayout dim=&quot;0&quot;&gt;
+                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Group type=&quot;102&quot; attributes=&quot;0&quot;&gt;
+                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                              &lt;Component id=&quot;jsDetailsSeparator&quot; alignment=&quot;0&quot; pref=&quot;153&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                                  &lt;Component id=&quot;jlblSelectTemplate&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;Component id=&quot;jcbxSelectTemplate&quot; pref=&quot;101&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;/Group&gt;
+                              &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                                  &lt;Component id=&quot;jlblTemplateAuthor&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                                  &lt;Component id=&quot;jlblTemplateAuthorValue&quot; pref=&quot;110&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;/Group&gt;
+                          &lt;/Group&gt;
+                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;/Group&gt;
+                  &lt;/Group&gt;
+                &lt;/DimensionLayout&gt;
+                &lt;DimensionLayout dim=&quot;1&quot;&gt;
+                  &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                      &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
+                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                              &lt;Component id=&quot;jlblSelectTemplate&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;Component id=&quot;jcbxSelectTemplate&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;/Group&gt;
+                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Component id=&quot;jsDetailsSeparator&quot; min=&quot;-2&quot; pref=&quot;10&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;EmptySpace max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;Group type=&quot;103&quot; groupAlignment=&quot;3&quot; attributes=&quot;0&quot;&gt;
+                              &lt;Component id=&quot;jlblTemplateAuthor&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                              &lt;Component id=&quot;jlblTemplateAuthorValue&quot; alignment=&quot;3&quot; min=&quot;-2&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
+                          &lt;/Group&gt;
+                          &lt;EmptySpace pref=&quot;88&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;/Group&gt;
+                  &lt;/Group&gt;
+                &lt;/DimensionLayout&gt;
+              &lt;/Layout&gt;
+              &lt;SubComponents&gt;
+                &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jlblSelectTemplate&quot;&gt;
+                  &lt;Properties&gt;
+                    &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+                      &lt;ResourceString bundle=&quot;de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/Bundle.properties&quot; key=&quot;ExportDlg.jlblSelectTemplate.text&quot; replaceFormat=&quot;org.openide.util.NbBundle.getMessage({sourceFileName}.class, &quot;{key}&quot;)&quot;/&gt;
+                    &lt;/Property&gt;
+                  &lt;/Properties&gt;
+                &lt;/Component&gt;
+                &lt;Component class=&quot;javax.swing.JComboBox&quot; name=&quot;jcbxSelectTemplate&quot;&gt;
+                  &lt;Properties&gt;
+                    &lt;Property name=&quot;model&quot; type=&quot;javax.swing.ComboBoxModel&quot; editor=&quot;org.netbeans.modules.form.editors2.ComboBoxModelEditor&quot;&gt;
+                      &lt;StringArray count=&quot;0&quot;/&gt;
+                    &lt;/Property&gt;
+                  &lt;/Properties&gt;
+                  &lt;Events&gt;
+                    &lt;EventHandler event=&quot;actionPerformed&quot; listener=&quot;java.awt.event.ActionListener&quot; parameters=&quot;java.awt.event.ActionEvent&quot; handler=&quot;jcbxSelectTemplateActionPerformed&quot;/&gt;
+                  &lt;/Events&gt;
+                &lt;/Component&gt;
+                &lt;Component class=&quot;javax.swing.JSeparator&quot; name=&quot;jsDetailsSeparator&quot;&gt;
+                &lt;/Component&gt;
+                &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jlblTemplateAuthor&quot;&gt;
+                  &lt;Properties&gt;
+                    &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+                      &lt;ResourceString bundle=&quot;de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/Bundle.properties&quot; key=&quot;ExportDlg.jlblTemplateAuthor.text&quot; replaceFormat=&quot;org.openide.util.NbBundle.getMessage({sourceFileName}.class, &quot;{key}&quot;)&quot;/&gt;
+                    &lt;/Property&gt;
+                  &lt;/Properties&gt;
+                &lt;/Component&gt;
+                &lt;Component class=&quot;javax.swing.JLabel&quot; name=&quot;jlblTemplateAuthorValue&quot;&gt;
+                  &lt;Properties&gt;
+                    &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+                      &lt;ResourceString bundle=&quot;de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/Bundle.properties&quot; key=&quot;ExportDlg.jlblTemplateAuthorValue.text&quot; replaceFormat=&quot;org.openide.util.NbBundle.getMessage({sourceFileName}.class, &quot;{key}&quot;)&quot;/&gt;
+                    &lt;/Property&gt;
+                  &lt;/Properties&gt;
+                &lt;/Component&gt;
+              &lt;/SubComponents&gt;
+            &lt;/Container&gt;
+            &lt;Component class=&quot;javax.swing.JCheckBox&quot; name=&quot;jchkTemplateOpenAfter&quot;&gt;
+              &lt;Properties&gt;
+                &lt;Property name=&quot;text&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
+                  &lt;ResourceString bundle=&quot;de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/Bundle.properties&quot; key=&quot;ExportDlg.jchkTemplateOpenAfter.text&quot; replaceFormat=&quot;org.openide.util.NbBundle.getMessage({sourceFileName}.class, &quot;{key}&quot;)&quot;/&gt;
+                &lt;/Property&gt;
+              &lt;/Properties&gt;
+              &lt;Events&gt;
+                &lt;EventHandler event=&quot;stateChanged&quot; listener=&quot;javax.swing.event.ChangeListener&quot; parameters=&quot;javax.swing.event.ChangeEvent&quot; handler=&quot;jchkTemplateOpenAfterStateChanged&quot;/&gt;
+              &lt;/Events&gt;
+            &lt;/Component&gt;
+          &lt;/SubComponents&gt;
         &lt;/Container&gt;
         &lt;Container class=&quot;javax.swing.JPanel&quot; name=&quot;jpProgressBar&quot;&gt;
           &lt;Constraints&gt;
@@ -239,7 +447,7 @@
                   &lt;Group type=&quot;102&quot; alignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
                       &lt;EmptySpace min=&quot;-2&quot; pref=&quot;46&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
                       &lt;Component id=&quot;jpbExportProgress&quot; min=&quot;-2&quot; pref=&quot;282&quot; max=&quot;-2&quot; attributes=&quot;0&quot;/&gt;
-                      &lt;EmptySpace pref=&quot;49&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
+                      &lt;EmptySpace pref=&quot;61&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
                   &lt;/Group&gt;
               &lt;/Group&gt;
             &lt;/DimensionLayout&gt;

Modified: trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/ExportDlg.java
===================================================================
--- trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/ExportDlg.java	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/ExportDlg.java	2008-06-12 01:17:02 UTC (rev 144)
@@ -26,7 +26,6 @@
 import de.berlios.jfindmyfiles.exportengine.SQL;
 import de.berlios.jfindmyfiles.exportengine.XLS;
 import de.berlios.jfindmyfiles.exportengine.XML;
-import java.awt.BorderLayout;
 import java.awt.CardLayout;
 import java.awt.Component;
 import java.io.File;
@@ -66,6 +65,10 @@
         setVisible(true);
     }
 
+    private void loadTemplates() {
+        //TODO: read template directory and load them in
+    }
+
     /** This method is called from within the constructor to
      * initialize the form.
      * WARNING: Do NOT modify this code. The content of this method is
@@ -83,7 +86,20 @@
         jlblDestination = new javax.swing.JLabel();
         jtfDestination = new javax.swing.JTextField();
         jbtnBrowse = new javax.swing.JButton();
+        jchkOpenAfter = new javax.swing.JCheckBox();
         jpTemplateExport = new javax.swing.JPanel();
+        jpPreview = new javax.swing.JPanel();
+        jlblPreview = new javax.swing.JLabel();
+        jlblTemplateDestination = new javax.swing.JLabel();
+        jtfTemplateDestination = new javax.swing.JTextField();
+        jbtnTemplateBrowse = new javax.swing.JButton();
+        jpTemplateDetails = new javax.swing.JPanel();
+        jlblSelectTemplate = new javax.swing.JLabel();
+        jcbxSelectTemplate = new javax.swing.JComboBox();
+        jsDetailsSeparator = new javax.swing.JSeparator();
+        jlblTemplateAuthor = new javax.swing.JLabel();
+        jlblTemplateAuthorValue = new javax.swing.JLabel();
+        jchkTemplateOpenAfter = new javax.swing.JCheckBox();
         jpProgressBar = new javax.swing.JPanel();
         jpbExportProgress = new javax.swing.JProgressBar();
         jbtnCancel = new javax.swing.JButton();
@@ -136,6 +152,13 @@
             }
         });
 
+        jchkOpenAfter.setText(org.openide.util.NbBundle.getMessage(ExportDlg.class, &quot;ExportDlg.jchkOpenAfter.text&quot;)); // NOI18N
+        jchkOpenAfter.addChangeListener(new javax.swing.event.ChangeListener() {
+            public void stateChanged(javax.swing.event.ChangeEvent evt) {
+                jchkOpenAfterStateChanged(evt);
+            }
+        });
+
         javax.swing.GroupLayout jpFileExportLayout = new javax.swing.GroupLayout(jpFileExport);
         jpFileExport.setLayout(jpFileExportLayout);
         jpFileExportLayout.setHorizontalGroup(
@@ -144,9 +167,12 @@
                 .addContainerGap()
                 .addComponent(jlblDestination)
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
-                .addComponent(jtfDestination, javax.swing.GroupLayout.DEFAULT_SIZE, 228, Short.MAX_VALUE)
-                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
-                .addComponent(jbtnBrowse)
+                .addGroup(jpFileExportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
+                    .addComponent(jchkOpenAfter)
+                    .addGroup(jpFileExportLayout.createSequentialGroup()
+                        .addComponent(jtfDestination, javax.swing.GroupLayout.DEFAULT_SIZE, 240, Short.MAX_VALUE)
+                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
+                        .addComponent(jbtnBrowse)))
                 .addContainerGap())
         );
         jpFileExportLayout.setVerticalGroup(
@@ -157,22 +183,134 @@
                     .addComponent(jlblDestination)
                     .addComponent(jbtnBrowse)
                     .addComponent(jtfDestination, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
-                .addContainerGap(266, Short.MAX_VALUE))
+                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
+                .addComponent(jchkOpenAfter)
+                .addContainerGap(241, Short.MAX_VALUE))
         );
 
         jpExportOptions.add(jpFileExport, &quot;card2&quot;);
 
         jpTemplateExport.setBorder(javax.swing.BorderFactory.createTitledBorder(org.openide.util.NbBundle.getMessage(ExportDlg.class, &quot;ExportDlg.jpTemplateExport.border.title&quot;))); // NOI18N
 
+        jpPreview.setBorder(javax.swing.BorderFactory.createTitledBorder(org.openide.util.NbBundle.getMessage(ExportDlg.class, &quot;ExportDlg.jpPreview.border.title&quot;))); // NOI18N
+
+        jlblPreview.setText(org.openide.util.NbBundle.getMessage(ExportDlg.class, &quot;ExportDlg.jlblPreview.text&quot;)); // NOI18N
+        jlblPreview.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
+
+        javax.swing.GroupLayout jpPreviewLayout = new javax.swing.GroupLayout(jpPreview);
+        jpPreview.setLayout(jpPreviewLayout);
+        jpPreviewLayout.setHorizontalGroup(
+            jpPreviewLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
+            .addComponent(jlblPreview, javax.swing.GroupLayout.DEFAULT_SIZE, 158, Short.MAX_VALUE)
+        );
+        jpPreviewLayout.setVerticalGroup(
+            jpPreviewLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
+            .addComponent(jlblPreview, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 125, Short.MAX_VALUE)
+        );
+
+        jlblTemplateDestination.setText(org.openide.util.NbBundle.getMessage(ExportDlg.class, &quot;ExportDlg.jlblTemplateDestination.text&quot;)); // NOI18N
+
+        jtfTemplateDestination.setText(org.openide.util.NbBundle.getMessage(ExportDlg.class, &quot;ExportDlg.jtfTemplateDestination.text&quot;)); // NOI18N
+
+        jbtnTemplateBrowse.setText(org.openide.util.NbBundle.getMessage(ExportDlg.class, &quot;ExportDlg.jbtnTemplateBrowse.text&quot;)); // NOI18N
+        jbtnTemplateBrowse.addActionListener(new java.awt.event.ActionListener() {
+            public void actionPerformed(java.awt.event.ActionEvent evt) {
+                jbtnTemplateBrowseActionPerformed(evt);
+            }
+        });
+
+        jlblSelectTemplate.setText(org.openide.util.NbBundle.getMessage(ExportDlg.class, &quot;ExportDlg.jlblSelectTemplate.text&quot;)); // NOI18N
+
+        jcbxSelectTemplate.addActionListener(new java.awt.event.ActionListener() {
+            public void actionPerformed(java.awt.event.ActionEvent evt) {
+                jcbxSelectTemplateActionPerformed(evt);
+            }
+        });
+
+        jlblTemplateAuthor.setText(org.openide.util.NbBundle.getMessage(ExportDlg.class, &quot;ExportDlg.jlblTemplateAuthor.text&quot;)); // NOI18N
+
+        jlblTemplateAuthorValue.setText(org.openide.util.NbBundle.getMessage(ExportDlg.class, &quot;ExportDlg.jlblTemplateAuthorValue.text&quot;)); // NOI18N
+
+        javax.swing.GroupLayout jpTemplateDetailsLayout = new javax.swing.GroupLayout(jpTemplateDetails);
+        jpTemplateDetails.setLayout(jpTemplateDetailsLayout);
+        jpTemplateDetailsLayout.setHorizontalGroup(
+            jpTemplateDetailsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
+            .addGroup(jpTemplateDetailsLayout.createSequentialGroup()
+                .addContainerGap()
+                .addGroup(jpTemplateDetailsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
+                    .addComponent(jsDetailsSeparator, javax.swing.GroupLayout.DEFAULT_SIZE, 153, Short.MAX_VALUE)
+                    .addGroup(jpTemplateDetailsLayout.createSequentialGroup()
+                        .addComponent(jlblSelectTemplate)
+                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
+                        .addComponent(jcbxSelectTemplate, 0, 101, Short.MAX_VALUE))
+                    .addGroup(jpTemplateDetailsLayout.createSequentialGroup()
+                        .addComponent(jlblTemplateAuthor)
+                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
+                        .addComponent(jlblTemplateAuthorValue, javax.swing.GroupLayout.DEFAULT_SIZE, 110, Short.MAX_VALUE)))
+                .addContainerGap())
+        );
+        jpTemplateDetailsLayout.setVerticalGroup(
+            jpTemplateDetailsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
+            .addGroup(jpTemplateDetailsLayout.createSequentialGroup()
+                .addContainerGap()
+                .addGroup(jpTemplateDetailsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
+                    .addComponent(jlblSelectTemplate)
+                    .addComponent(jcbxSelectTemplate, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
+                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
+                .addComponent(jsDetailsSeparator, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE)
+                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
+                .addGroup(jpTemplateDetailsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
+                    .addComponent(jlblTemplateAuthor)
+                    .addComponent(jlblTemplateAuthorValue))
+                .addContainerGap(88, Short.MAX_VALUE))
+        );
+
+        jchkTemplateOpenAfter.setText(org.openide.util.NbBundle.getMessage(ExportDlg.class, &quot;ExportDlg.jchkTemplateOpenAfter.text&quot;)); // NOI18N
+        jchkTemplateOpenAfter.addChangeListener(new javax.swing.event.ChangeListener() {
+            public void stateChanged(javax.swing.event.ChangeEvent evt) {
+                jchkTemplateOpenAfterStateChanged(evt);
+            }
+        });
+
         javax.swing.GroupLayout jpTemplateExportLayout = new javax.swing.GroupLayout(jpTemplateExport);
         jpTemplateExport.setLayout(jpTemplateExportLayout);
         jpTemplateExportLayout.setHorizontalGroup(
             jpTemplateExportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
-            .addGap(0, 361, Short.MAX_VALUE)
+            .addGroup(jpTemplateExportLayout.createSequentialGroup()
+                .addContainerGap()
+                .addGroup(jpTemplateExportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
+                    .addGroup(jpTemplateExportLayout.createSequentialGroup()
+                        .addComponent(jpPreview, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
+                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
+                        .addComponent(jpTemplateDetails, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
+                    .addGroup(jpTemplateExportLayout.createSequentialGroup()
+                        .addComponent(jlblTemplateDestination)
+                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
+                        .addGroup(jpTemplateExportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
+                            .addComponent(jchkTemplateOpenAfter)
+                            .addGroup(jpTemplateExportLayout.createSequentialGroup()
+                                .addComponent(jtfTemplateDestination, javax.swing.GroupLayout.DEFAULT_SIZE, 240, Short.MAX_VALUE)
+                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
+                                .addComponent(jbtnTemplateBrowse)))))
+                .addContainerGap())
         );
         jpTemplateExportLayout.setVerticalGroup(
             jpTemplateExportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
-            .addGap(0, 300, Short.MAX_VALUE)
+            .addGroup(jpTemplateExportLayout.createSequentialGroup()
+                .addGroup(jpTemplateExportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
+                    .addGroup(jpTemplateExportLayout.createSequentialGroup()
+                        .addComponent(jpPreview, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
+                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED))
+                    .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jpTemplateExportLayout.createSequentialGroup()
+                        .addComponent(jpTemplateDetails, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
+                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)))
+                .addGroup(jpTemplateExportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
+                    .addComponent(jlblTemplateDestination)
+                    .addComponent(jbtnTemplateBrowse)
+                    .addComponent(jtfTemplateDestination, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
+                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
+                .addComponent(jchkTemplateOpenAfter)
+                .addContainerGap(91, Short.MAX_VALUE))
         );
 
         jpExportOptions.add(jpTemplateExport, &quot;card3&quot;);
@@ -188,7 +326,7 @@
             .addGroup(jpProgressBarLayout.createSequentialGroup()
                 .addGap(46, 46, 46)
                 .addComponent(jpbExportProgress, javax.swing.GroupLayout.PREFERRED_SIZE, 282, javax.swing.GroupLayout.PREFERRED_SIZE)
-                .addContainerGap(49, Short.MAX_VALUE))
+                .addContainerGap(61, Short.MAX_VALUE))
         );
         jpProgressBarLayout.setVerticalGroup(
             jpProgressBarLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
@@ -231,7 +369,7 @@
                     .addGroup(layout.createSequentialGroup()
                         .addComponent(jpExportType, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                         .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
-                        .addComponent(jpExportOptions, javax.swing.GroupLayout.DEFAULT_SIZE, 377, Short.MAX_VALUE))
+                        .addComponent(jpExportOptions, javax.swing.GroupLayout.DEFAULT_SIZE, 389, Short.MAX_VALUE))
                     .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                         .addComponent(jbtnExport)
                         .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
@@ -285,23 +423,34 @@
     //csv html sql ods xls xml
     switch (jlstExportTypes.getSelectedIndex()) {
         case 0://CSV
-            new CSV(selectedFile).export();
+            CSV cvs = new CSV(selectedFile);
+            cvs.addListener(this);
+            cvs.export();
             break;
         case 1://HTML
-            new HTML(selectedFile, &quot;&quot;, &quot;&quot;);//TODO: get the proper values for HTML export
+            HTML html = new HTML(selectedFile, &quot;&quot;, &quot;&quot;);//TODO: get the proper values for HTML export
+            html.addListener(this);
+            html.export();
             break;
         case 2://SQL
-            new SQL(selectedFile).export();
+            SQL sql = new SQL(selectedFile);
+            sql.addListener(this);
+            sql.export();
             break;
         case 3://ODS
-            new ODS(selectedFile);
+            ODS ods = new ODS(selectedFile);
+            ods.addListener(this);
+            ods.export();
             break;
         case 4://XLS
-            new XLS(selectedFile);
+            XLS xls = new XLS(selectedFile);
+            xls.addListener(this);
+            xls.export();
             break;
         case 5://XML
-            new XML(selectedFile).export();
-
+            XML xml = new XML(selectedFile);
+            xml.addListener(this);
+            xml.export();
     }
 }//GEN-LAST:event_jbtnExportActionPerformed
 
@@ -316,22 +465,77 @@
         jtfDestination.setText(selectedFile.getAbsolutePath().trim());
     }
 }//GEN-LAST:event_jbtnBrowseActionPerformed
+
+private void jbtnTemplateBrowseActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jbtnTemplateBrowseActionPerformed
+    JFileChooser jfc = new JFileChooser();
+    if (jfc.showSaveDialog(this) == JFileChooser.APPROVE_OPTION) {
+        selectedFile = jfc.getSelectedFile();
+        jtfTemplateDestination.setText(selectedFile.getAbsolutePath().trim());
+    }
+}//GEN-LAST:event_jbtnTemplateBrowseActionPerformed
+
+private void jchkOpenAfterStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_jchkOpenAfterStateChanged
+// TODO add your handling code here:
+}//GEN-LAST:event_jchkOpenAfterStateChanged
+
+private void jchkTemplateOpenAfterStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_jchkTemplateOpenAfterStateChanged
+// TODO add your handling code here:
+}//GEN-LAST:event_jchkTemplateOpenAfterStateChanged
+
+private void jcbxSelectTemplateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jcbxSelectTemplateActionPerformed
+// TODO add your handling code here:
+}//GEN-LAST:event_jcbxSelectTemplateActionPerformed
     // Variables declaration - do not modify//GEN-BEGIN:variables
     private javax.swing.JScrollPane jScrollPane1;
     private javax.swing.JButton jbtnBrowse;
     private javax.swing.JButton jbtnCancel;
     private javax.swing.JButton jbtnExport;
     private javax.swing.JButton jbtnHelp;
+    private javax.swing.JButton jbtnTemplateBrowse;
+    private javax.swing.JComboBox jcbxSelectTemplate;
+    private javax.swing.JCheckBox jchkOpenAfter;
+    private javax.swing.JCheckBox jchkTemplateOpenAfter;
     private javax.swing.JLabel jlblDestination;
+    private javax.swing.JLabel jlblPreview;
+    private javax.swing.JLabel jlblSelectTemplate;
+    private javax.swing.JLabel jlblTemplateAuthor;
+    private javax.swing.JLabel jlblTemplateAuthorValue;
+    private javax.swing.JLabel jlblTemplateDestination;
     private javax.swing.JList jlstExportTypes;
     private javax.swing.JPanel jpExportOptions;
     private javax.swing.JPanel jpExportType;
     private javax.swing.JPanel jpFileExport;
+    private javax.swing.JPanel jpPreview;
     private javax.swing.JPanel jpProgressBar;
+    private javax.swing.JPanel jpTemplateDetails;
     private javax.swing.JPanel jpTemplateExport;
     private javax.swing.JProgressBar jpbExportProgress;
+    private javax.swing.JSeparator jsDetailsSeparator;
     private javax.swing.JTextField jtfDestination;
+    private javax.swing.JTextField jtfTemplateDestination;
     // End of variables declaration//GEN-END:variables
+    public void exportStarted() {
+        visiblePanel = 2;
+        CardLayout lay = (CardLayout) jpExportOptions.getLayout();
+        lay.last(jpExportOptions);
+    }
+
+    public void exportFinished() {
+        if (previousPanel == 0) {
+            CardLayout lay = (CardLayout) jpExportOptions.getLayout();
+            lay.first(jpExportOptions);
+        } else {
+            CardLayout lay = (CardLayout) jpExportOptions.getLayout();
+            lay.previous(jpExportOptions);
+        }
+        visiblePanel = previousPanel;
+    }
+
+    public void exportError() {
+        //TODO: show error message
+        throw new UnsupportedOperationException(&quot;Not supported yet.&quot;);
+    }
+
     /**
      * Renderer class for showing icons on the list of existing export options
      */
@@ -372,26 +576,34 @@
             return this;
         }
     }
+    
+    private class Template {
+        
+        private ImageIcon preview;
+        private String author;
+        private String name;
+        
+        public Template(ImageIcon preview, String author, String name) {
+            this.preview = preview;
+            this.author = author;
+            this.name = name;
+        }
 
-    public void exportStarted() {
-        visiblePanel = 2;
-        CardLayout lay = (CardLayout) jpExportOptions.getLayout();
-        lay.last(jpExportOptions);
-    }
+        public String getAuthor() {
+            return author;
+        }
 
-    public void exportFinished() {
-        if (previousPanel == 0) {
-            CardLayout lay = (CardLayout) jpExportOptions.getLayout();
-            lay.first(jpExportOptions);
-        } else {
-            CardLayout lay = (CardLayout) jpExportOptions.getLayout();
-            lay.previous(jpExportOptions);
+        public String getName() {
+            return name;
         }
-        visiblePanel = previousPanel;
-    }
 
-    public void exportError() {
-        //TODO: show error message
-        throw new UnsupportedOperationException(&quot;Not supported yet.&quot;);
+        public ImageIcon getPreview() {
+            return preview;
+        }
+        
+        @Override
+        public String toString() {
+            return name;
+        }
     }
 }

Modified: trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/NewDiskDlg.java
===================================================================
--- trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/NewDiskDlg.java	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs/NewDiskDlg.java	2008-06-12 01:17:02 UTC (rev 144)
@@ -24,6 +24,7 @@
 import de.berlios.jfindmyfiles.readingfiles.MediaReader;
 import de.berlios.jfindmyfiles.readingfiles.ReadingEvent;
 import de.berlios.jfindmyfiles.readingfiles.ReadingListener;
+import java.awt.Dimension;
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
 import java.io.File;
@@ -102,7 +103,10 @@
         }
         toggle = new JToggleButton();
         toggle.setIcon(new ImageIcon(Utilities.loadImage(&quot;de/berlios/jfindmyfiles/jfindmyfilesgui/resources/images/x22/button-folder.png&quot;))); // NOI18N
-
+        toggle.setMaximumSize(new Dimension(100, 24));
+        toggle.setMinimumSize(new Dimension(24, 24));
+        toggle.setSize(toggle.getWidth(), 24);
+        
         toggle.setHorizontalTextPosition(SwingConstants.CENTER);
         toggle.setVerticalTextPosition(SwingConstants.BOTTOM);
         toggle.addActionListener(new ActionListener() {
@@ -363,7 +367,7 @@
     MediaReader r = Lookup.getDefault().lookup(MediaReader.class);
     r.addListener(scanningDlg);
     r.addListener(this);
-    r.read(new File(currentSelectedPath), calculateHash, isMedia, jtfDiskName.getText().trim(), (DiskGroup) jcbxCatalog.getSelectedItem(), null);
+    r.read(new File(currentSelectedPath), calculateHash, isMedia, jtfDiskName.getText().trim(), (DiskGroup) jcbxCatalog.getSelectedItem());
 
 }//GEN-LAST:event_jbtnScanActionPerformed
 

Modified: trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/nodes/DiskNode.java
===================================================================
--- trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/nodes/DiskNode.java	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/nodes/DiskNode.java	2008-06-12 01:17:02 UTC (rev 144)
@@ -21,6 +21,7 @@
 
 import de.berlios.jfindmyfiles.catalog.entities.Media;
 import de.berlios.jfindmyfiles.jfindmyfilesgui.actions.ActionSearchForItems;
+import de.berlios.jfindmyfiles.jfindmyfilesgui.utils.GuiUtils;
 import java.awt.Image;
 import org.openide.nodes.AbstractNode;
 import org.openide.nodes.Children;
@@ -36,9 +37,11 @@
 public class DiskNode extends AbstractNode {
 
     private SystemAction[] sysact;
-
+    private Media media;
+    
     public DiskNode(Media media) {
         super(Children.LEAF);
+        this.media = media;
         setName(media.getName());
 
         Lookup lo = Lookups.forPath(&quot;/Actions&quot;);//TODO: sort actions correctly and add separators
@@ -47,8 +50,8 @@
 
     @Override
     public Image getIcon(int type) {
-        //TODO: depending on the  type of media give the right icon
-        return Utilities.loadImage(&quot;de/berlios/jfindmyfiles/jfindmyfilesgui/resources/images/x16/icon-media-drive-optical.png&quot;); // NOI18N
+        //return Utilities.loadImage(&quot;de/berlios/jfindmyfiles/jfindmyfilesgui/resources/images/x16/icon-media-drive-optical.png&quot;); // NOI18N
+        return Utilities.loadImage(GuiUtils.findIconForType(media.getType())); // NOI18N
     }
 
     @Override

Modified: trunk/project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles/MediaReader.java
===================================================================
--- trunk/project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles/MediaReader.java	2008-06-11 16:46:15 UTC (rev 143)
+++ trunk/project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles/MediaReader.java	2008-06-12 01:17:02 UTC (rev 144)
@@ -23,7 +23,6 @@
 import de.berlios.jfindmyfiles.catalog.entities.DiskGroup;
 import de.berlios.jfindmyfiles.catalog.entities.FileWrapper;
 import de.berlios.jfindmyfiles.catalog.entities.Media;
-import de.berlios.jfindmyfiles.catalog.entities.Type;
 import de.berlios.jfindmyfiles.readingfiles.utils.ReadingUtils;
 import java.io.File;
 import java.util.Stack;
@@ -41,7 +40,7 @@
         listeners = new Vector&lt;ReadingListener&gt;();
     }
 
-    public void read(final File file, final boolean sha, final boolean isMedia, final String mediaName, final DiskGroup group, final Type type) {
+    public void read(final File file, final boolean sha, final boolean isMedia, final String mediaName, final DiskGroup group) {
 
         new Thread(new Runnable() {
 
@@ -55,11 +54,9 @@
                 long childSize = 0L, totalSize = 0L;
                 FileWrapper fw, temp;
                 int z;
-                Type t = new Type(&quot;test&quot;);
-                s.save(t);
                 Media container = new Media();
                 container.setName(mediaName);
-                container.setType(t);
+                container.setType(ReadingUtils.findFileType(file.getAbsolutePath()));
                 s.save(container);
 
                 if ((listing = file.listFiles()) != null) {
@@ -74,7 +71,7 @@
                                     listing[z].length(), listing[z].isFile(),
                                     listing[z].isHidden(),
                                     listing[z].lastModified(), container, null,
-                                    (sha ? ReadingUtils.calculateSHA1HashString(listing[z]) : &quot;&quot;), 
+                                    (sha ? ReadingUtils.calculateSHA1HashString(listing[z]) : &quot;&quot;),
                                     ReadingUtils.findExtension(listing[z].getName()));
                             s.save(temp);
                             container.addFile(temp);
@@ -103,7 +100,7 @@
                                         listing[z].length(), listing[z].isFile(),
                                         listing[z].isHidden(),
                                         listing[z].lastModified(), container, fw,
-                                        (sha ? ReadingUtils.calculateSHA1HashString(listing[z]) : &quot;&quot;), 
+                                        (sha ? ReadingUtils.calculateSHA1HashString(listing[z]) : &quot;&quot;),
                                         ReadingUtils.findExtension(listing[z].getName()));
                                 s.save(temp);
                                 fw.addChild(temp);
@@ -116,9 +113,10 @@
                 //TODO: capacity and other properties
                 if (abort) {
                     s.getTransaction().rollback();
+                } else {
+                    s.getTransaction().commit();
+                    fireReadingStopped(new ReadingEvent(me, &quot;&quot;, container));
                 }
-                s.getTransaction().commit();
-                fireReadingStopped(new ReadingEvent(me, &quot;&quot;, container));
             }
         }).start();
     }

Deleted: trunk/spikes/Prototipos/src/de/berlios/kcookb/imagens/Thumbs.db
===================================================================
(Binary files differ)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000138.html">[Jfindmyfiles-commits] r143 - in trunk/project/JFindMyFiles:	Catalog/src/de/berlios/jfindmyfiles/catalog	ExportEngine/src/de/berlios/jfindmyfiles/exportengine	JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/dialogs	JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui/utils	ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles	ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles/utils
</A></li>
	<LI>Next message: <A HREF="000140.html">[Jfindmyfiles-commits] r145 - in trunk: docs/Iteracao3-CB03	project/JFindMyFiles/Catalog/src/de/berlios/jfindmyfiles/catalog/entities	project/JFindMyFiles/JFindMyFilesGui/src/de/berlios/jfindmyfiles/jfindmyfilesgui	project/JFindMyFiles/ReadingFiles/nbproject	project/JFindMyFiles/ReadingFiles/src/META-INF/services	project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles	project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles/pluginapi	project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles/plugins	project/JFindMyFiles/ReadingFiles/src/de/berlios/jfindmyfiles/readingfiles/utils	spikes/PluginAPI spikes/PluginAPI/nbproject spikes/PluginAPI/src	spikes/PluginAPI/src/de/berlios/jfindmyfiles	spikes/PluginAPI/src/de/berlios/jfindmyfiles/catalog/entities	spikes/PluginAPI/src/pluginapi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#139">[ date ]</a>
              <a href="thread.html#139">[ thread ]</a>
              <a href="subject.html#139">[ subject ]</a>
              <a href="author.html#139">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/jfindmyfiles-commits">More information about the Jfindmyfiles-commits
mailing list</a><br>
</body></html>
